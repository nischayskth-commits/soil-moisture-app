<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Soil Moisture Predictor ‚Äî Enhanced</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <style>
    :root {
      --card-bg: rgba(255,255,255,0.95);
      --accent: #2b9cff;
      --muted: #6b7280;
    }

    html, body { height: 100%; margin:0; padding:0; }

    /* Soil Background Slideshow */
    .bg-slideshow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-size: cover;
      background-position: center;
      animation: bgChange 20s infinite;
      filter: brightness(0.85);
    }

    @keyframes bgChange {
      0%   { background-image: url("images/soil1.jpg"); }
      25%  { background-image: url("images/soil2.jpg"); }
      50%  { background-image: url("images/soil3.jpg"); }
      75%  { background-image: url("images/soil4.jpg"); }
      100% { background-image: url("images/soil1.jpg"); }
    }

    /* Body layout */
    body {
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:40px;
      overflow-y:auto;
    }

    /* floating blobs */
    .blob {
      position: fixed;
      filter: blur(70px);
      opacity: .28;
      z-index: 0;
      animation: floaty 12s ease-in-out infinite;
      border-radius: 50%;
      mix-blend-mode: screen;
    }
    .blob.b1{ width:420px; height:420px; left:-120px; top:-80px; background: #d8f1ff; animation-duration:18s; }
    .blob.b2{ width:360px; height:360px; right:-100px; bottom:-60px; background: #ffe6f0; animation-duration:16s; }

    @keyframes floaty {
      0% { transform: translateY(0px) translateX(0px) rotate(0deg); }
      50% { transform: translateY(-30px) translateX(18px) rotate(6deg); }
      100% { transform: translateY(0px) translateX(0px) rotate(0deg); }
    }

    /* main card */
    .app-card {
      width: 100%; max-width:720px;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 10px 30px rgba(15,23,42,0.08);
      padding: 28px;
      position: relative;
      z-index: 2;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .app-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 18px 40px rgba(15,23,42,0.12);
    }

    h1 { font-weight:700; margin-bottom:6px; font-size:22px; }
    .subtitle { color:var(--muted); font-size:14px; margin-bottom:18px; }

    label { font-weight:600; font-size:14px; color:#233044; margin-top:12px; }
    .form-control { border-radius:10px; padding:10px 12px; }

    .btn-main{
      border-radius:10px; padding:10px 14px;
      transition:transform .12s ease;
    }
    .btn-main:active{ transform:translateY(1px) }

    /* Result box */
    .result {
      border-radius:12px;
      padding:14px;
      margin-top:14px;
      opacity:0;
      transform:translateY(8px);
      transition:.3s;
    }
    .result.show{
      opacity:1;
      transform:translateY(0px);
    }

    .low { background: linear-gradient(90deg,#fff5f5,#ffdede); border-left:4px solid #ff6b6b; color:#7a0c0c }
    .medium { background: linear-gradient(90deg,#fffaf0,#fff5cc); border-left:4px solid #f59e0b; color:#553d00 }
    .high { background: linear-gradient(90deg,#f0fff5,#dfffe7); border-left:4px solid #0ea5a3; color:#064e3b }

    .rec-card { border-radius:10px; padding:12px; background:#ffffff; border:1px solid rgba(15,23,42,.04); margin-top:10px; }

    footer { text-align:center; color:#80848f; font-size:13px; margin-top:18px; }

  </style>
</head>
<body>

<!-- Background slideshow -->
<div class="bg-slideshow"></div>

<!-- floating blobs -->
<div class="blob b1"></div>
<div class="blob b2"></div>

<div class="app-card container">

  <div class="row">
    <div class="col-12 text-center">
      <h1>üåø Soil Moisture Predictor</h1>
      <div class="subtitle">Predict soil moisture & get recommendations ‚Äî crops, fertilizer & actions</div>
    </div>
  </div>

  <!-- controls -->
  <div class="row g-2 mt-2">
    <div class="col-12 text-center mb-2">
      <button class="btn btn-info btn-main w-100" id="btn-weather">
        <i class="fa-solid fa-cloud-sun-rain me-2"></i> Auto-Fill Weather Data
      </button>
    </div>

    <div class="col-md-6">
      <label>Temperature (¬∞C)</label>
      <input id="temperature" class="form-control" type="number" value="25">
    </div>

    <div class="col-md-6">
      <label>Humidity (%)</label>
      <input id="humidity" class="form-control" type="number" value="60">
    </div>

    <div class="col-md-6">
      <label>Rainfall (mm)</label>
      <input id="rainfall" class="form-control" type="number" value="4">
    </div>

    <div class="col-md-6">
      <label>Soil Type (Manual)</label>
      <select id="soil_type" class="form-control">
        <option value="0">Sandy</option>
        <option value="1" selected>Loam</option>
        <option value="2">Clay</option>
      </select>
    </div>

    <div class="col-12">
      <label>Upload Soil Image</label>
      <input id="soilImage" class="form-control" type="file" accept="image/*">
    </div>

    <div class="col-12 text-center mt-2">
      <button id="btn-predict" class="btn btn-primary btn-main w-100">
        <i class="fa-solid fa-magnifying-glass me-2"></i> Predict Moisture
      </button>
    </div>

    <!-- results -->
    <div class="col-12">
      <div id="moistBox" class="result low" style="display:none;">
        <strong id="moistText"></strong><br>
        <span id="catText"></span>
      </div>

      <div id="actionCard" class="rec-card" style="display:none;">
        <strong id="actionText"></strong><br>
        <small id="explainText" class="text-muted"></small>
      </div>

      <div id="recGrid" class="mt-3" style="display:none;">
        <div><strong>Recommended Crops:</strong> <span id="cropList"></span></div>
        <div class="mt-2"><strong>Fertilizer Tips:</strong> <span id="fertList"></span></div>
      </div>

      <footer>Made with ‚ù§Ô∏è for Smart Farming</footer>
    </div>
  </div>

</div>

<script>
const API = "https://soil-moisture-backend-r7m2.onrender.com";

/* Category tag */
function categoryTag(v){
  if(v<15)return"Low (Dry)";
  if(v<30)return"Medium (Optimal)";
  return"High (Wet)";
}

/* Crop recommendation */
function recommendCrops(category, soil, t){
  if(category.includes("Low"))
    return "Millet, Sorghum, Groundnut, Chickpea";
  if(category.includes("Medium"))
    return "Tomato, Okra, Maize, Wheat";
  return "Rice, Sugarcane, Lotus";
}

/* Fertilizer recommendation */
function recommendFertilizer(soil, cat){
  if(soil==0) return "Sandy: Add compost & slow-release NPK.";
  if(soil==1) return "Loam: Balanced NPK + seasonal compost.";
  if(cat.includes("High"))
    return "Clay & wet: Improve drainage, add gypsum.";
  return "Clay: Add organic matter; avoid heavy N after rain.";
}

/* Hide results */
function hideResults(){
  document.getElementById("moistBox").style.display="none";
  document.getElementById("actionCard").style.display="none";
  document.getElementById("recGrid").style.display="none";
}

/* Predict */
document.getElementById("btn-predict").onclick=async()=>{
  hideResults();

  let soilType = parseInt(document.getElementById("soil_type").value);

  const fileInput=document.getElementById("soilImage");
  if(fileInput.files.length>0){
    const fd=new FormData();
    fd.append("file", fileInput.files[0]);
    const up=await fetch(`${API}/upload`,{method:"POST",body:fd});
    const uj=await up.json();
    if(uj.soil_type!==undefined){
      soilType=uj.soil_type;
      document.getElementById("soil_type").value=soilType;
    }
  }

  const body={
    temperature:parseFloat(document.getElementById("temperature").value),
    humidity:parseFloat(document.getElementById("humidity").value),
    rainfall:parseFloat(document.getElementById("rainfall").value),
    soil_type:soilType
  };

  const res=await fetch(`${API}/predict`,{
    method:"POST",headers:{"Content-Type":"application/json"},
    body:JSON.stringify(body)
  });

  const data=await res.json();

  document.getElementById("moistText").innerHTML=`Moisture: <strong>${data.moisture}%</strong>`;
  document.getElementById("catText").innerText=`Category: ${data.category}`;

  let box=document.getElementById("moistBox");
  if(data.category.includes("Low")) box.className="result low";
  else if(data.category.includes("Medium")) box.className="result medium";
  else box.className="result high";

  box.style.display="block";
  box.classList.add("show");

  document.getElementById("actionCard").style.display="block";
  document.getElementById("actionText").innerText=
    data.category.includes("Low") ? "Irrigate soon; soil is dry." :
    data.category.includes("Medium") ? "Moisture optimal; maintain routines." :
    "Avoid irrigation; soil is wet.";

  document.getElementById("explainText").innerText="Model-based estimation.";

  document.getElementById("cropList").innerText=recommendCrops(data.category, soilType);
  document.getElementById("fertList").innerText=recommendFertilizer(soilType,data.category);

  document.getElementById("recGrid").style.display="block";
};
</script>

</body>
</html>
